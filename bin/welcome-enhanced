#!/bin/bash

# Enhanced Terminal Welcome Script
# Supports multiple modes and configurations

# Load configuration
CONFIG_FILE="${HOME}/.config/terminal-welcome/config"
[[ -f "$CONFIG_FILE" ]] && source "$CONFIG_FILE"

# Parse command line options
while [[ $# -gt 0 ]]; do
    case $1 in
        -q|--quote-only)
            SHOW_SYSTEM_INFO=false
            SHOW_TIPS=false
            shift
            ;;
        -s|--system-only)
            SHOW_QUOTE=false
            SHOW_TIPS=false
            shift
            ;;
        -m|--minimal)
            SHOW_TIPS=false
            shift
            ;;
        -c|--custom)
            SYSTEM_INFO_PROVIDER=custom
            shift
            ;;
        -f|--fastfetch)
            SYSTEM_INFO_PROVIDER=fastfetch
            shift
            ;;
        -h|--help)
            echo "Usage: $(basename $0) [OPTIONS]"
            echo ""
            echo "Options:"
            echo "  -q, --quote-only    Show only quote"
            echo "  -s, --system-only   Show only system info"
            echo "  -m, --minimal       Skip tips section"
            echo "  -c, --custom        Use custom system info"
            echo "  -f, --fastfetch     Use fastfetch for system info"
            echo "  -h, --help          Show this help message"
            echo ""
            echo "Configuration file: $CONFIG_FILE"
            exit 0
            ;;
        *)
            echo "Unknown option: $1"
            echo "Use --help for usage information"
            exit 1
            ;;
    esac
done

# Display quote if enabled
if [[ "$SHOW_QUOTE" == "true" ]]; then
    echo ""
    $(dirname "$0")/quote
    echo ""
fi

# Display system info if enabled
if [[ "$SHOW_SYSTEM_INFO" == "true" ]]; then
    case "$SYSTEM_INFO_PROVIDER" in
        fastfetch)
            if command -v fastfetch &> /dev/null; then
                fastfetch
            else
                echo "Fastfetch not installed. Install with: brew install fastfetch"
            fi
            ;;
        neofetch)
            if command -v neofetch &> /dev/null; then
                neofetch
            else
                echo "Neofetch not installed. Install with: brew install neofetch"
            fi
            ;;
        custom)
            # Use the original custom welcome script
            if [[ -f "$HOME/.dotfiles/terminal-welcome/terminal-welcome.sh" ]]; then
                USE_NEW_WELCOME=true source "$HOME/.dotfiles/terminal-welcome/terminal-welcome.sh"
            else
                echo "Custom welcome script not found"
            fi
            ;;
        *)
            echo "Unknown system info provider: $SYSTEM_INFO_PROVIDER"
            ;;
    esac
fi

# Display tips if enabled
if [[ "$SHOW_TIPS" == "true" ]] && [[ "$SHOW_RANDOM_TIP" == "true" ]]; then
    tips=(
        "ðŸ’¡ Use 'z <dir>' to quickly jump to directories"
        "ðŸ’¡ Press Ctrl+R to search command history"
        "ðŸ’¡ Use 'extract <archive>' to extract any format"
        "ðŸ’¡ Type 'weather' to check the forecast"
        "ðŸ’¡ Use 'todo' to manage quick tasks"
        "ðŸ’¡ Use 'gcme feat \"message\"' for emoji git commits"
        "ðŸ’¡ Type 'note' to take timestamped notes"
        "ðŸ’¡ Use 'mkcd' to create and enter a directory"
        "ðŸ’¡ Press ESC twice to add sudo to last command"
        "ðŸ’¡ Use 'dot' to manage your dotfiles"
    )
    
    echo ""
    echo "${tips[$RANDOM % ${#tips[@]}]}"
fi